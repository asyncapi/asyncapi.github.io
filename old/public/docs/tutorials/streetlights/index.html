<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="In this tutorial, you get started with actual code and a (could-be) real-world use case." />





<meta itemprop="name" content="Streetlights | AsyncAPI Initiative">
<meta itemprop="description" content="In this tutorial, you get started with actual code and a (could-be) real-world use case.">
<meta itemprop="image" content="https://www.asyncapi.com/images/social/card.png">


<meta name="twitter:card" value="summary_large_image">
<meta name="twitter:title" content="Streetlights | AsyncAPI Initiative">
<meta name="twitter:description" content="In this tutorial, you get started with actual code and a (could-be) real-world use case.">
<meta name="twitter:image" content="https://www.asyncapi.com/images/social/card.png">


<meta property="og:title" content="Streetlights | AsyncAPI Initiative" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.asyncapi.com/docs/tutorials/streetlights/" />
<meta property="og:image" content="https://www.asyncapi.com/images/social/card.png" />
<meta property="og:description" content="In this tutorial, you get started with actual code and a (could-be) real-world use case." />
    <title>Streetlights | AsyncAPI Initiative</title>
    
<link rel="icon" type="image/png" href="https://www.asyncapi.com/images/favicon.png" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.css">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-highlight/prism-line-highlight.min.css">
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-icons.css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />

<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans:400,600" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.min.260ea99a5f7dc3017f88aff6236f79487d2ea3ef0a2b0a7900937ccb2261b595.css">

</head>

<body>
    <a href="https://github.com/asyncapi/asyncapi" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
            viewBox="0 0 250 250" style="fill:#46a2c7; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg></a>
    <style>
        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out
        }
    
        @keyframes octocat-wave {
    
            0%,
            100% {
                transform: rotate(0)
            }
    
            20%,
            60% {
                transform: rotate(-25deg)
            }
    
            40%,
            80% {
                transform: rotate(10deg)
            }
        }
    
        @media (max-width:500px) {
            .github-corner:hover .octo-arm {
                animation: none
            }
    
            .github-corner .octo-arm {
                animation: octocat-wave 560ms ease-in-out
            }
        }
    </style>
    


<header class="nav">
  <div class="nav__holder">
    <div class="container-fluid container-semi-fluid nav__container">
      <div class="flex-parent">

        <div class="nav__header">
          
          <a href="/" class="logo-container flex-child">
            <img class="logo" src="/img/logo.png" alt="AsyncAPI logo">
          </a>

          
          <button type="button" class="nav__icon-toggle" id="nav__icon-toggle" data-toggle="collapse"
            data-target="#navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="nav__icon-toggle-bar"></span>
            <span class="nav__icon-toggle-bar"></span>
            <span class="nav__icon-toggle-bar"></span>
          </button>
        </div>

        
        <nav id="navbar-collapse" class="nav__wrap collapse navbar-collapse">
          <ul class="nav__menu">
            <li class="nav__dropdown">
              <a>Learn</a>
              <i class="ui-arrow-down nav__dropdown-trigger"></i>
              <ul class="nav__dropdown-menu">
                <li><a href="/docs/getting-started" >Get started</a></li>
                <li><a href="/docs/tutorials" >Tutorials</a></li>
                <li><a href="/docs/specifications/latest" >Specification</a></li>
              </ul>
            </li>
            <li class="nav__dropdown">
              <a>Tooling</a>
              <i class="ui-arrow-down nav__dropdown-trigger"></i>
              <ul class="nav__dropdown-menu">
                <li><a href="http://playground.asyncapi.io?utm_source=asyncapi.com&amp;utm_medium=top-menu" target="_blank" >Playground</a></li>
                <li><a href="/docs/tooling#codegens" >Code generators</a></li>
                <li><a href="/docs/tooling#docgens" >Documentation generators</a></li>
                <li><a href="/docs/tooling#validators" >Validators</a></li>
                <li><a href="/docs/tooling#code-first" >Code-first tools</a></li>
                <li><a href="/docs/tooling#others" >Others</a></li>
              </ul>
            </li>
            <li>
              <a href="/blog"  >Blog</a>
            </li>
            <li class="nav__dropdown">
              <a>Help</a>
              <i class="ui-arrow-down nav__dropdown-trigger"></i>
              <ul class="nav__dropdown-menu">
                <li><a href="https://github.com/asyncapi/asyncapi" target="_blank" >Github repo</a></li>
                <li><a href="https://asyncapi.com/slack-invite" target="_blank" >Slack workspace</a></li>
              </ul>
            </li>
            <li>
              <a href="/about"  >About</a>
            </li>
            <li><a href="/docs/getting-started" style="font-weight: bold; color: #46a2c7;">Get Started</a></li>
            <li>
              <a href="https://asyncapi.threadless.com/" target="_blank"  style="color: #df02dd;">Shop</a>
            </li>
          </ul> 
        </nav> 

        <div class="nav__btn-holder nav--align-right">
          <a href="https://opencollective.com/asyncapi" target="_blank" class="btn nav__btn">
            <span class="nav__btn-text">We need your help</span>
            <span class="nav__btn-phone">Donate</span>
          </a>
        </div>

      </div> 
    </div> 

  </div>
</header> 
    
    
<div class="container" style="padding:0 2rem;margin-top:30px;">
    <div class="row">
        <div class="col-md-3">
            <aside class="docs-menu">
    <h3>Menu</h3>
    <ul>
        
        
        
        <li>
            
                <a href="/docs/getting-started/">
                    
                    <span>Getting started</span>
                </a>
            
        </li>
        <ul class="sub-menu">
            
                
                <li>
                    <a href="/docs/getting-started/event-driven-architectures/">
                        
                        <span>Event-driven architectures</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/getting-started/coming-from-openapi/">
                        
                        <span>Coming from OpenAPI</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/getting-started/asyncapi-documents/">
                        
                        <span>AsyncAPI documents</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/getting-started/hello-world/">
                        
                        <span>Hello world</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/getting-started/servers/">
                        
                        <span>Servers</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/getting-started/security/">
                        
                        <span>Adding security</span>
                    </a>
                </li>
                
            
        </ul>
        
        
        
        <li>
            
                <a href="/docs/tutorials/">
                    
                    <span>Tutorials</span>
                </a>
            
        </li>
        <ul class="sub-menu">
            
                
                <li class="active">
                    
                    <span>Streetlights</span>
                </li>
                
            
        </ul>
        
        
        
        <li>
            
                <a href="/docs/specifications/latest">
                    
                    <span>Specification</span>
                </a>
            
        </li>
        <ul class="sub-menu">
            
                
                <li>
                    <a href="/docs/specifications/2.0.0/">
                        
                        <span>2.0.0</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/specifications/1.2.0/">
                        
                        <span>1.2.0</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/specifications/1.1.0/">
                        
                        <span>1.1.0</span>
                    </a>
                </li>
                
            
                
                <li>
                    <a href="/docs/specifications/1.0.0/">
                        
                        <span>1.0.0</span>
                    </a>
                </li>
                
            
        </ul>
        
        
    </ul>
</aside>
        </div>
        <div class="col-md-9">
            <div class="row">
    <div class="col-12">
        <h1 class="title section-title">Streetlights</h1>
    </div>
</div>
<div class="row">
    <div class="col-12 docs-content"><p>In this tutorial, you get started with actual code and a (could-be) real-world use case.</p>

<p>Let&rsquo;s pretend you have a company called Smarty Lighting and you do smart-city lighting systems.</p>

<h1 id="system-description">System Description<a href="#system-description" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<p>You want to create a system capable of turning on/off the streetlights depending on the environmental conditions of each of them:</p>

<ul>
<li>You&rsquo;re going to implement an event-driven architecture, with a Message Broker in its &ldquo;center&rdquo;.</li>
<li>Streetlights will send information about its environmental lighting to the broker.</li>
<li>None of the services waits for any kind of response. Think about it as <em>fire and forget</em>. You publish messages to the broker and that&rsquo;s it. Your service doesn&rsquo;t know who receives them.</li>
</ul>

<h1 id="technology">Technology<a href="#technology" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<p>You&rsquo;ll use Node.js to code APIs and Mosquitto as the message broker. Selected technology is irrelevant here, as things explained here in this tutorial are applicable to any other programming language and message brokers.</p>

<h1 id="the-asyncapi-file">The AsyncAPI file<a href="#the-asyncapi-file" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<p>Let&rsquo;s start by creating an AsyncAPI file to describe your API. It will help you generate the code and the documentation later.</p>

<pre><code class="language-yaml">asyncapi: '2.0.0'
info:
  title: Streetlights API
  version: '1.0.0'
  description: |
    The Smartylighting Streetlights API allows you
    to remotely manage the city lights.
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'

servers:
  mosquitto:
    url: mqtt://test.mosquitto.org
    protocol: mqtt

channels:
  light/measured:
    publish:
      summary: Inform about environmental lighting conditions for a particular streetlight.
      operationId: onLightMeasured
      message:
        payload:
          type: object
          properties:
            id:
              type: integer
              minimum: 0
              description: Id of the streetlight.
            lumens:
              type: integer
              minimum: 0
              description: Light intensity measured in lumens.
            sentAt:
              type: string
              format: date-time
              description: Date and time when the message was sent.
</code></pre>

<p>Let&rsquo;s break it down into pieces:</p>

<pre><code class="language-yaml">asyncapi: '2.0.0'
info:
  title: Streetlights API
  version: '1.0.0'
  description: |
    The Smartylighting Streetlights API allows you
    to remotely manage the city lights.
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'
</code></pre>

<ul>
<li>The <code>asyncapi</code> field indicates you use AsyncAPI version 2.0.0.</li>
<li>Inside the <code>info</code> field you find information about the API, like its name, version, description, and its license.</li>
</ul>

<p>We&rsquo;re now going for the <code>channels</code> section. It is used to describe the event names your API will be publishing and/or subscribing to.</p>

<pre><code class="language-yaml">channels:
  light/measured:
    publish:
      summary: Inform about environmental lighting conditions for a particular streetlight.
      operationId: onLightMeasured
</code></pre>

<p>In this example, <code>light/measured</code> is the channel name your API <code>publish</code> to. The <code>operationId</code> property, describes what will be the name of function or method that takes care of this functionality in generated code. To understand how the event should look like when publishing to that channel, there is the <code>payload</code> property:</p>

<pre><code class="language-yaml">      payload:
        type: object
        properties:
          id:
            type: integer
            minimum: 0
            description: Id of the streetlight.
          lumens:
            type: integer
            minimum: 0
            description: Light intensity measured in lumens.
          sentAt:
            type: string
            format: date-time
            description: Date and time when the message was sent.
</code></pre>

<p><code>Payload</code> property defines the content of the event using AsyncAPI schemas. It means that your event payload should contain an <code>id</code> and a <code>lumens</code> property —which are integers bigger than zero—, and a <code>sentAt</code> property that should be a string containing a date and time.</p>

<blockquote>
<p>JSON Schema Draft 07 is 100% compatible with AsyncAPI schemas.</p>
</blockquote>

<p>Cool! So you&rsquo;re done with your AsyncAPI file! Let&rsquo;s get into generating code.</p>

<h1 id="generating-code">Generating code<a href="#generating-code" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<p>To generate your code you&rsquo;ll use the <a href="https://github.com/asyncapi/generator" target="_blank">AsyncAPI Generator</a> Node.js template.</p>

<ol>
<li><p>Install the generator to use is at a command-line tool</p>

<pre><code class="language-bash">npm install -g asyncapi-generator
</code></pre></li>

<li><p>Create a directory for your projects and enter it:</p>

<pre><code class="language-bash">mkdir streetlights &amp;&amp; cd &quot;$_&quot;
</code></pre></li>

<li><p>Create a file with the AsyncAPI machine-readable description you defined before. On Windows use <code>type</code> instead of <code>cat</code>:</p>

<pre><code class="language-bash">cat &lt;&lt;EOT &gt;&gt; asyncapi.yaml
asyncapi: '2.0.0'
info:
  title: Streetlights API
  version: '1.0.0'
  description: |
    The Smartylighting Streetlights API allows you
    to remotely manage the city lights.
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'

servers:
  mosquitto:
    url: mqtt://test.mosquitto.org
    protocol: mqtt

channels:
  light/measured:
    publish:
      summary: Inform about environmental lighting conditions for a particular streetlight.
      operationId: onLightMeasured
      message:
        payload:
          type: object
          properties:
            id:
              type: integer
              minimum: 0
              description: Id of the streetlight.
            lumens:
              type: integer
              minimum: 0
              description: Light intensity measured in lumens.
            sentAt:
              type: string
              format: date-time
              description: Date and time when the message was sent.
EOT
</code></pre></li>

<li><p>Trigger generation of the Node.js code:</p>

<pre><code class="language-bash">ag asyncapi.yaml nodejs -p server=mosquitto
</code></pre></li>

<li><p>And voilà! List all files in directory and notice that Node.js application is generated:</p>

<pre><code class="language-bash">ls
</code></pre></li>
</ol>

<h1 id="running-your-code">Running your code<a href="#running-your-code" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<ol>
<li><p>Install dependencies of newly generated application:</p>

<pre><code class="language-bash">npm install
</code></pre></li>

<li><p>Start the application:</p>

<pre><code class="language-bash">npm start
</code></pre></li>

<li><p>In another terminal install the MQTT.js library:</p>

<pre><code class="language-bash">npm install mqtt -g
</code></pre></li>

<li><p>Send message to your application:</p>

<pre><code class="language-bash">mqtt pub -t 'light/measured' -h 'test.mosquitto.org' -m '{&quot;id&quot;: 1, &quot;lumens&quot;: 3, &quot;sentAt&quot;: &quot;2017-06-07T12:34:32.000Z&quot;}'
</code></pre></li>

<li><p>Go back to previous terminal and notice that your application logs the message you just sent.</p></li>
</ol>

<h1 id="conclusions">Conclusions<a href="#conclusions" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h1>

<p>You&rsquo;ve learned how to create an AsyncAPI description file and how to generate code from it. The code is a bootstrap and you&rsquo;ll need to add your business logic into it. Take some time to play with it.
There are still lots of things to be covered but intent of this tutorial is to be simple so you get an idea of the potential.</p>

<p>We would also like to see what you create with AsyncAPI. As an open-source project, we&rsquo;re open to proposals, questions, suggestions, and contributions. If you don&rsquo;t feel in the mood to contribute but you&rsquo;re using AsyncAPI, just raise your hand <a href="https://github.com/asyncapi/asyncapi/issues/new" target="_blank">creating a issue in our Github repo</a> or <a href="https://www.asyncapi.com/slack-invite/" target="_blank">join our Slack channel</a>. Don&rsquo;t be shy :)</p></div>
</div>
        </div>
        <div class="hint">
    <div class="hint__body">
        <hr>Improve this page by providing edits suggestions <a target="_blank" href="https://github.com/asyncapi/website/edit/master/content/docs/tutorials/streetlights.md">here</a>. After providing suggestions to the text, submit a Pull Request using <a target="_blank" href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request">this</a>        instruction. You can also suggest changes by <a target="_blank" href="https://github.com/asyncapi/website/issues/new">reporting an issue</a>. Feel free to contact us on <a target="_blank" href="https://asyncapi.com/slack-invite">Slack</a> for questions.
    </div>
</div>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="footer__widgets">
            <div class="row">

                <div class="col-lg-3 col-md-6">
                    <div class="widget widget-about-us">
                        
                        <a href="index.html" class="logo-container flex-child">
                            <img class="logo" src="/img/logo.png" alt="AsyncAPI logo">
                        </a>
                        <p class="mt-24 mb-32">Building the future of event-driven architectures.</p>
                        <div class="socials">
                            <a href="https://twitter.com/AsyncAPISpec" class="social social-twitter" aria-label="twitter" title="Twitter" target="_blank"><i class="ui-twitter"></i></a>
                            <a href="https://www.linkedin.com/company/asyncapi" class="social social-linkedin" aria-label="linkedin" title="LinkedIn" target="_blank"><i class="ui-linkedin"></i></a>
                        </div>
                    </div>
                </div>
                


                <div class="col-lg-2 offset-lg-6 col-md-6">
                    <div class="widget widget_nav_menu">
                        <h5 class="widget-title">Resources</h5>
                        <ul>
                            <li><a href="/about">About</a></li>
                            <li><a href="/blog">Blog</a></li>
                            <li><a href="https://github.com/asyncapi" target="_blank">Github</a></li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>
    

    <div class="footer__bottom top-divider">
        <div class="container text-center">
            <span class="copyright">
        Made with <code>:love:</code> by the AsyncAPI Initiative.
      </span>
            <div>
                <a href="https://www.netlify.com">
                    <img src="https://www.netlify.com/img/global/badges/netlify-color-bg.svg" />
                </a>
            </div>
        </div>
    </div>
    
</footer>


<div id="back-to-top">
    <a href="#top"><i class="ui-arrow-up"></i></a>
</div>


    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109278936-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-109278936-1');
</script>


<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/scripts.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script src="/js/cookies.js"></script>


<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-yaml.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-highlight/prism-line-highlight.min.js"></script>

<script>
    $('pre code').addClass('line-numbers');
</script>


<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function (regs) {
      if (regs && regs.length > 0) {
        for (var registration of regs) {
          registration.unregister();
        }
      }
    });
  }
</script>
</body>

</html>